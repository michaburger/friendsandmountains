{% extends "base.html" %}
{% load markdown_deux_tags %}
{% load static %}
{% block title %}{{ event.title }}{% endblock %}

{% block header_image_src %}
    {{ event.main_image.url }}
{% endblock header_image_src %}

{% block content %}
<div class="event-detail">
  <h1 class="mb-4">{{ event.title }}</h1>
  
  <!-- Intro Card (Always shown) -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-4">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-calendar3 me-3 fs-3 text-primary"></i>
            <div>
              <div>{{ event.start_date|date:"F d, Y" }}</div>
              <div>to {{ event.end_date|date:"F d, Y" }}</div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="mb-2"><strong>Location:</strong> {{ event.town_name }}</div>
          <div><strong>Venue:</strong> {{ event.house_name }}</div>
        </div>
        <div class="col-md-4 text-md-end">
          {% if event.couchsurfing_link %}
            <a href="{{ event.couchsurfing_link }}" target="_blank" class="btn btn-outline-primary">
              <i class="bi bi-globe me-1"></i> Find this event on Couchsurfing
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  {% now "Y-m-d" as today %}
  {% if event.end_date|date:"Y-m-d" < today %}
    <!-- Past Event Content -->
    <div class="alert alert-info fw-bold text-center mb-4">
      <i class="bi bi-hourglass-bottom me-2"></i> This event is over <i class="bi bi-emoji-frown"></i>
    </div>
    
    <!-- Event Story -->
    <div class="card mb-4 shadow-sm">
      <div class="card-header bg-light">
        <h2 class="h4 mb-0">Event Story</h2>
      </div>
      <div class="card-body markdown-content">
        {{ event.event_story|markdown }}
      </div>
    </div>
    
    <!-- Gallery -->
    {% if gallery_images %}
    <div class="card mb-4 shadow-sm">
      <div class="card-header bg-light">
        <h2 class="h4 mb-0">Photo Gallery</h2>
      </div>
      <div class="card-body">
        <div class="row gallery-grid g-3">
          {% for image in gallery_images %}
          <div class="col-md-4 col-sm-6">
            <img src="{{ image.image.url }}" 
                 alt="{{ image.caption|default:event.title }}" 
                 class="img-fluid rounded shadow-sm clickable-image" 
                 onclick="showImage('{{ image.image.url }}', '{{ image.caption|default:event.title }}')"
                 data-bs-toggle="modal" 
                 data-bs-target="#imageModal">
            {% if image.caption %}
            <div class="image-caption small text-center mt-1">{{ image.caption }}</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
    
  {% else %}
    <!-- Future Event Content -->
    <div class="alert alert-success fw-bold text-center mb-4">
      <i class="bi bi-calendar-check me-2"></i> This event is in the future
    </div>
    
    <!-- Content for future events would go here -->
    
  {% endif %}
</div>

<!-- Modal for displaying enlarged images -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imageModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <img id="modalImage" src="" alt="" class="img-fluid">
      </div>
    </div>
  </div>
</div>

<!-- Add JavaScript for image modal -->
<script>
  function showImage(src, alt) {
    document.getElementById('modalImage').src = src;
    document.getElementById('modalImage').alt = alt;
    document.getElementById('imageModalLabel').textContent = alt;
  }

  // Add cursor pointer to all clickable images
  document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('.clickable-image');
    images.forEach(img => {
      img.style.cursor = 'pointer';
    });
  });
</script>
{% endblock %}